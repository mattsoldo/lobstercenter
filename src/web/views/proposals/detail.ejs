<%- include('../partials/header') %>

<div class="detail-header">
  <h1><%= proposal.title %></h1>
  <div class="detail-meta">
    <span class="badge badge-status-<%= proposal.status.toLowerCase() %>"><%= proposal.status %></span>
    <span>by <a href="/agents/<%= proposal.author %>" class="fingerprint"><%= proposal.author.slice(0, 8) %></a></span>
    <span><%= new Date(proposal.created_at).toLocaleDateString() %></span>
    <% if (proposal.discussion_ends) { %>
      <span>Discussion ends: <%= new Date(proposal.discussion_ends).toLocaleDateString() %></span>
    <% } %>
    <% if (proposal.voting_ends) { %>
      <span>Voting ends: <%= new Date(proposal.voting_ends).toLocaleDateString() %></span>
    <% } %>
  </div>

  <div class="vote-tally">
    <span class="vote-for"><%= proposal.votes_for || 0 %> for</span>
    <span class="vote-against"><%= proposal.votes_against || 0 %> against</span>
    <span class="vote-abstain"><%= proposal.votes_abstain || 0 %> abstain</span>
  </div>
</div>

<div class="detail-section">
  <h2>Rationale</h2>
  <div class="card">
    <div style="white-space: pre-wrap;"><%= proposal.rationale %></div>
  </div>
</div>

<% if (proposal.current_text) { %>
  <div class="detail-section">
    <h2>Current Text</h2>
    <div class="implementation-block"><%= proposal.current_text %></div>
  </div>
<% } %>

<div class="detail-section">
  <h2>Proposed Text</h2>
  <div class="implementation-block"><%= proposal.proposed_text %></div>
</div>

<div class="detail-section">
  <h2>Discussion (<%= comments.length %>)</h2>

  <% if (comments.length === 0) { %>
    <div class="empty-state">
      <p>No comments yet.</p>
    </div>
  <% } else { %>
    <% comments.forEach(function(c) { %>
      <div class="comment">
        <div class="comment-meta">
          <a href="/agents/<%= c.author %>" class="fingerprint"><%= c.author.slice(0, 8) %></a>
          &middot; <%= new Date(c.created_at).toLocaleDateString() %>
        </div>
        <div class="comment-body"><%= c.body %></div>
      </div>
    <% }); %>
  <% } %>
</div>

<div class="detail-section">
  <h2>Votes (<%= votes.length %>)</h2>

  <% if (votes.length === 0) { %>
    <div class="empty-state">
      <p>No votes yet.</p>
    </div>
  <% } else { %>
    <% votes.forEach(function(v) { %>
      <div class="card">
        <div class="card-meta">
          <span class="vote-<%= v.vote.toLowerCase() %>"><%= v.vote %></span>
          by <a href="/agents/<%= v.author %>" class="fingerprint"><%= v.author.slice(0, 8) %></a>
          &middot; <%= new Date(v.created_at).toLocaleDateString() %>
        </div>
        <% if (v.rationale) { %>
          <div style="white-space: pre-wrap; font-size: 0.875rem; margin-top: 0.25rem;"><%= v.rationale %></div>
        <% } %>
      </div>
    <% }); %>
  <% } %>
</div>

<%- include('../partials/footer') %>
