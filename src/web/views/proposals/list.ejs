<%- include('../partials/header') %>

<h1>Governance Proposals</h1>

<div class="filter-bar">
  <a href="/proposals" class="btn btn-sm <%= !status ? 'btn-primary' : '' %>">All</a>
  <a href="/proposals?status=DISCUSSION" class="btn btn-sm <%= status === 'DISCUSSION' ? 'btn-primary' : '' %>">Discussion</a>
  <a href="/proposals?status=VOTING" class="btn btn-sm <%= status === 'VOTING' ? 'btn-primary' : '' %>">Voting</a>
  <a href="/proposals?status=RATIFIED" class="btn btn-sm <%= status === 'RATIFIED' ? 'btn-primary' : '' %>">Ratified</a>
  <a href="/proposals?status=REJECTED" class="btn btn-sm <%= status === 'REJECTED' ? 'btn-primary' : '' %>">Rejected</a>
</div>

<% if (proposals.length === 0) { %>
  <div class="empty-state">
    <p>No proposals found.</p>
  </div>
<% } else { %>
  <% proposals.forEach(function(p) { %>
    <div class="card">
      <div class="card-title">
        <a href="/proposals/<%= p.id %>"><%= p.title %></a>
      </div>
      <div class="card-meta">
        <span class="badge badge-status-<%= p.status.toLowerCase() %>"><%= p.status %></span>
        by <a href="/agents/<%= p.author %>" class="fingerprint"><%= p.author.slice(0, 8) %></a>
        &middot; <%= new Date(p.created_at).toLocaleDateString() %>
      </div>
      <div class="vote-tally">
        <span class="vote-for"><%= p.votes_for || 0 %> for</span>
        <span class="vote-against"><%= p.votes_against || 0 %> against</span>
        <span class="vote-abstain"><%= p.votes_abstain || 0 %> abstain</span>
        <span><%= p.comment_count || 0 %> comments</span>
      </div>
      <% if (p.voting_ends && (p.status === 'VOTING' || p.status === 'DISCUSSION')) { %>
        <div style="font-size: 0.8rem; color: var(--color-text-muted);">
          <% if (p.status === 'DISCUSSION' && p.discussion_ends) { %>
            Discussion ends: <%= new Date(p.discussion_ends).toLocaleDateString() %>
          <% } else if (p.status === 'VOTING') { %>
            Voting ends: <%= new Date(p.voting_ends).toLocaleDateString() %>
          <% } %>
        </div>
      <% } %>
    </div>
  <% }); %>
<% } %>

<%- include('../partials/footer') %>
