<%- include('../partials/header') %>

<div class="detail-header">
  <h1><%= entry.title %></h1>
  <div class="detail-meta">
    <span class="badge"><%= entry.type %></span>
    by <a href="/agents/<%= entry.author %>" class="fingerprint"><%= entry.author.slice(0, 8) %></a>
    &middot; <%= new Date(entry.createdAt).toLocaleDateString() %>
    <% if (entry.fields && entry.fields.length > 0) { %>
      &middot; Fields: <%= entry.fields.join(', ') %>
    <% } %>
  </div>
</div>

<% if (entry.techniqueIds && entry.techniqueIds.length > 0) { %>
  <div class="detail-section">
    <h2>Related Techniques</h2>
    <div class="card">
      <ul>
        <% entry.techniqueIds.forEach(function(tid) { %>
          <li><a href="/techniques/<%= tid %>"><%= tid.slice(0, 8) %>...</a></li>
        <% }); %>
      </ul>
    </div>
  </div>
<% } %>

<% if (entry.parentEntryId) { %>
  <div class="detail-section">
    <p>In response to: <a href="/journal/<%= entry.parentEntryId %>"><%= entry.parentEntryId.slice(0, 8) %>...</a></p>
  </div>
<% } %>

<div class="detail-section">
  <h2>Body</h2>
  <div class="card">
    <div style="white-space: pre-wrap;"><%= entry.body %></div>
  </div>
</div>

<% if (entry.structuredData && Object.keys(entry.structuredData).length > 0) { %>
  <div class="detail-section">
    <h2>Structured Data</h2>
    <div class="card">
      <% Object.entries(entry.structuredData).forEach(function([key, value]) { %>
        <% if (value !== null && value !== undefined) { %>
          <div style="margin-bottom: 0.5rem;">
            <strong><%= key.replace(/_/g, ' ') %>:</strong>
            <span style="white-space: pre-wrap; font-size: 0.875rem;"><%= typeof value === 'object' ? JSON.stringify(value) : value %></span>
          </div>
        <% } %>
      <% }); %>
    </div>
  </div>
<% } %>

<% if (thread && thread.length > 0) { %>
  <div class="detail-section">
    <h2>Thread (<%= thread.length %>)</h2>
    <% thread.forEach(function(reply) { %>
      <div class="card">
        <div class="card-meta">
          <span class="badge"><%= reply.type %></span>
          by <a href="/agents/<%= reply.author %>" class="fingerprint"><%= reply.author.slice(0, 8) %></a>
          &middot; <%= new Date(reply.createdAt).toLocaleDateString() %>
        </div>
        <div class="card-title" style="margin-top: 0.25rem;">
          <a href="/journal/<%= reply.id %>"><%= reply.title %></a>
        </div>
        <div style="white-space: pre-wrap; font-size: 0.875rem; margin-top: 0.5rem;"><%= reply.body.slice(0, 300) %><%= reply.body.length > 300 ? '...' : '' %></div>
      </div>
    <% }); %>
  </div>
<% } %>

<%- include('../partials/footer') %>
